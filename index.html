<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shroudfall Dice Roller – Choose Dice Colors</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0; padding: 1em;
    text-align: center;
  }

  #diceColorSelectors {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 1.5em;
    flex-wrap: wrap;
  }

  .dice-select-wrapper {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  select {
    font-size: 1em;
    font-weight: bold;
    padding: 0.3em 0.6em;
    border-radius: 4px;
    border: 1px solid #ccc;
    min-width: 120px;
    color: #000;
    appearance: none;
    background-color: white;
    cursor: pointer;
  }

  .color-indicator {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    border: 1px solid #999;
  }
  .grey { background-color: #888; }
  .yellow { background-color: #f1c40f; }
  .red { background-color: #e74c3c; }
  .none { background-color: transparent; border: 1px dashed #bbb;}

  .dice-container {
    display: inline-flex;
    align-items: center;
    margin: 6px;
    vertical-align: middle;
  }

  img.dice-img {
    width: 48px;
    height: 48px;
    margin-right: 8px;
    vertical-align: middle;
  }

  .step-header {
    font-weight: bold;
    margin-bottom: 0.5em;
  }

  .buttons {
    margin: 1em 0;
    font-size: 1.1em;
  }

  button {
    font-size: 1em;
    padding: 0.4em 1em;
    margin: 0.2em;
    cursor: pointer;
  }

  input[type="checkbox"] {
    margin-left: 8px;
    cursor: pointer;
  }

  /* Mobilanpassning */
  @media (max-width: 600px) {
    #diceColorSelectors {
      flex-direction: column;
      align-items: center;
      gap: 14px;
    }
  }
</style>
</head>
<body>

<h1>Shroudfall Dice Roller – Choose Dice Colors</h1>

<div id="diceColorSelectors">
  <div class="dice-select-wrapper">
    <div class="color-indicator" id="color-indicator-0"></div>
    <select id="die0" onchange="updateColorIndicator(0)">
      <option value="grey">Grey</option>
      <option value="yellow">Yellow</option>
      <option value="red">Red</option>
    </select>
  </div>
  <div class="dice-select-wrapper">
    <div class="color-indicator" id="color-indicator-1"></div>
    <select id="die1" onchange="updateColorIndicator(1)">
      <option value="grey">Grey</option>
      <option value="yellow">Yellow</option>
      <option value="red">Red</option>
    </select>
  </div>
  <div class="dice-select-wrapper">
    <div class="color-indicator" id="color-indicator-2"></div>
    <select id="die2" onchange="updateColorIndicator(2)">
      <option value="grey">Grey</option>
      <option value="yellow">Yellow</option>
      <option value="red">Red</option>
    </select>
  </div>
  <div class="dice-select-wrapper">
    <div class="color-indicator" id="color-indicator-3"></div>
    <select id="die3" onchange="updateColorIndicator(3)">
      <option value="grey">Grey</option>
      <option value="yellow">Yellow</option>
      <option value="red">Red</option>
    </select>
  </div>
  <div class="dice-select-wrapper">
    <div class="color-indicator" id="color-indicator-4"></div>
    <select id="die4" onchange="updateColorIndicator(4)">
      <option value="none">None</option>
      <option value="grey">Grey</option>
      <option value="yellow">Yellow</option>
      <option value="red">Red</option>
    </select>
  </div>
</div>

<div class="buttons">
  <button id="btnRoll" onclick="initialRoll()">Roll All Dice</button>
  <button id="btnEssenceReroll" onclick="essenceReroll()" style="display:none;">Essence Reroll (all dice)</button>
  <button id="btnActiveReroll" onclick="activePlayerReroll()" style="display:none;">Active Player: Reroll Selected</button>
  <button id="btnInactiveReroll" onclick="inactivePlayerReroll()" style="display:none;">Inactive Player: Reroll Selected</button>
  <button id="btnShowFinal" onclick="showFinal()" style="display:none;">Show Final Result</button>
  <button id="btnReset" onclick="resetAll()" style="display:none;">Reset</button>
</div>

<div class="results" id="results"></div>

<script>
  const greyDie = [0, 0, 1, 1, 2, 2]; // Nu kan grey slå 0 (blank)
  const yellowDie = [0, 1, 2, 2, 3, 3];
  const redDie    = [2, 2, 3, 3, 4, 4];

  let currentRolls = [];
  let nextDieId = 0;
  let step = 1;

  const btnRoll = document.getElementById('btnRoll');
  const btnEssence = document.getElementById('btnEssenceReroll');
  const btnActiveReroll = document.getElementById('btnActiveReroll');
  const btnInactiveReroll = document.getElementById('btnInactiveReroll');
  const btnShowFinal = document.getElementById('btnShowFinal');
  const btnReset = document.getElementById('btnReset');

  function rollDie(color) {
    let dieArray;
    if(color === 'grey') dieArray = greyDie;
    else if(color === 'yellow') dieArray = yellowDie;
    else if(color === 'red') dieArray = redDie;
    else return null;
    return dieArray[Math.floor(Math.random() * dieArray.length)];
  }

  function initialRoll() {
    currentRolls = [];
    nextDieId = 0;

    for(let i=0; i<5; i++){
      const sel = document.getElementById(`die${i}`);
      const color = sel.value;
      if(color === 'none') continue;
      currentRolls.push({color, value: rollDie(color), id: nextDieId++});
    }

    document.getElementById('diceColorSelectors').style.display = 'none';
    btnRoll.style.display = 'none';

    step = 2;
    btnEssence.style.display = 'inline-block';
    btnActiveReroll.style.display = 'inline-block';
    btnInactiveReroll.style.display = 'none';
    btnShowFinal.style.display = 'none';
    btnReset.style.display = 'inline-block';

    updateResults("Step 1: Initial Roll");
  }

  function essenceReroll() {
    if(step !== 2) return;
    currentRolls.forEach(die => die.value = rollDie(die.color));
    btnEssence.style.display = 'none';
    btnActiveReroll.style.display = 'inline-block';
    btnReset.style.display = 'inline-block';
    updateResults("Step 2: Essence Reroll (all dice)");
  }

  function activePlayerReroll(){
    if(step !== 2 && step !== 3) return;
    currentRolls.forEach(die => {
      const checkbox = document.getElementById('active_reroll_chk_' + die.id);
      if(checkbox && checkbox.checked) die.value = rollDie(die.color);
    });
    step = 3;
    btnEssence.style.display = 'none';
    btnActiveReroll.style.display = 'none';
    btnInactiveReroll.style.display = 'inline-block';
    updateResults("Step 3: Active Player Reroll");
  }

  function inactivePlayerReroll(){
    if(step !== 3) return;
    currentRolls.forEach(die => {
      const checkbox = document.getElementById('inactive_reroll_chk_' + die.id);
      if(checkbox && checkbox.checked) die.value = rollDie(die.color);
    });
    step = 4;
    btnInactiveReroll.style.display = 'none';
    btnShowFinal.style.display = 'inline-block';
    updateResults("Step 4: Inactive Player Reroll");
  }

  function showFinal() {
    if(step !== 4) return;
    updateResults("Final Result");
    btnShowFinal.style.display = 'none';
  }

  function resetAll() {
    currentRolls = [];
    nextDieId = 0;
    step = 1;
    document.getElementById('diceColorSelectors').style.display = 'flex';
    btnRoll.style.display = 'inline-block';
    btnEssence.style.display = 'none';
    btnActiveReroll.style.display = 'none';
    btnInactiveReroll.style.display = 'none';
    btnShowFinal.style.display = 'none';
    btnReset.style.display = 'none';
    updateResults('');
  }

  function updateResults(headerText) {
    const container = document.getElementById('results');
    container.innerHTML = '';

    if(headerText){
      const h = document.createElement('h2');
      h.className = 'step-header';
      h.textContent = headerText;
      container.appendChild(h);
    }

    currentRolls.forEach(die => {
      const dieDiv = document.createElement('div');
      dieDiv.className = 'dice-container';

      const img = document.createElement('img');
      img.className = 'dice-img';
      img.src = `images/${die.color}_${die.value}.png`;
      img.alt = `${die.color} die showing ${die.value}`;
      dieDiv.appendChild(img);

      const textSpan = document.createElement('span');
      textSpan.textContent = `${die.color.charAt(0).toUpperCase() + die.color.slice(1)} Die: ${die.value}`;
      dieDiv.appendChild(textSpan);

      if(step === 2){
        const chk = document.createElement('input');
        chk.type = 'checkbox';
        chk.id = `active_reroll_chk_${die.id}`;
        dieDiv.appendChild(chk);
      } else if(step === 3){
        const chk = document.createElement('input');
        chk.type = 'checkbox';
        chk.id = `inactive_reroll_chk_${die.id}`;
        dieDiv.appendChild(chk);
      }

      container.appendChild(dieDiv);
    });

    // Summan visas alltid
    if(currentRolls.length > 0){
      const total = currentRolls.reduce((sum, die) => sum + die.value, 0);
      const sumEl = document.createElement('h3');
      sumEl.textContent = "Total Sum: " + total;
      container.appendChild(sumEl);
    }
  }

  function updateColorIndicator(index){
    const select = document.getElementById(`die${index}`);
    const color = select.value;
    const indicator = document.getElementById(`color-indicator-${index}`);
    indicator.className = 'color-indicator ' + color;

    switch(color){
      case 'grey': select.style.backgroundColor='#bbb'; select.style.color='#000'; break;
      case 'yellow': select.style.backgroundColor='#f9e065'; select.style.color='#000'; break;
      case 'red': select.style.backgroundColor='#f28a82'; select.style.color='#000'; break;
      case 'none': default: select.style.backgroundColor='white'; select.style.color='#000'; break;
    }
  }

  window.onload = () => { for(let i=0;i<5;i++) updateColorIndicator(i); };
</script>

</body>
</html>
